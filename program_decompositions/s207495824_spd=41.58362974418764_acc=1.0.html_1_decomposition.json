{"optimized_code": "/*\n \n Code By RyeCatcher\n \n */\n \n #include <bits/stdc++.h>\n \n \n \n #define ri register int \n \n #define ll long long \n \n #define ull unsigned long long \n \n \n \n using std::min;\n \n using std::max;\n \n using std::lower_bound;\n \n using namespace __gnu_pbds;\n \n \n \n template <class T> inline void read(T &x){\n \n     x = 0; int ne = 0; char c;\n \n     while(!isdigit(c = getchar())) ne = (c == '-');\n \n     x = c - '0';\n \n     while(isdigit(c = getchar())) x = (x << 3) + (x << 1) + c - '0';\n \n     x = ne ? -x : x; \n \n     return;\n \n }\n \n \n \n const int maxn = 200005;\n \n const int inf = 0x7fffffff;\n \n \n \n int n, nn, a[maxn], b[maxn], c[maxn], mx = -inf, mi = inf;\n \n ll sum[maxn << 2];\n \n \n \n inline void update(int x, int d){\n \n     for(; x <= nn; x += x & (-x)) sum[x] += d;\n \n }\n \n \n \n inline ll query(int x){\n \n     ll ans = 0;\n \n     for(; x; x -= x & (-x)) ans += sum[x];\n \n     return ans;\n \n }\n \n \n \n inline ll chk(int k){\n \n     ll ans = 0;\n \n     b[0] = 0;\n \n     for(ri i = 1; i <= n; i++){\n \n         b[i] = b[i-1] + ((a[i] <= k) ? 1 : -1);\n \n         c[i] = b[i];\n \n         ans += (b[i] > 0);\n \n     }\n \n     std::sort(c + 1, c + 1 + n);\n \n     nn = std::unique(c + 1, c + 1 + n) - (c + 1);\n \n     memset(sum, 0, sizeof(sum));\n \n     for(ri i = 1; i <= n; i++){\n \n         b[i] = lower_bound(c + 1, c + 1 + nn, b[i]) - c;\n \n         ans += query(b[i] - 1);\n \n         update(b[i], 1);\n \n     }\n \n     return ans;\n \n }\n \n \n \n int main(){\n \n     read(n);\n \n     for(ri i = 1; i <= n; i++){\n \n         read(a[i]);\n \n         mi = min(mi, a[i]), mx = max(mx, a[i]);\n \n     }\n \n     int L = mi, R = mx, mid, ans;\n \n     ll lim = 1ll * n * (n + 1) / 4 + 1; // \u6ce8\u610flong long \n \n     while(L <= R){\n \n         mid = (L + R) >> 1;\n \n         if(chk(mid) >= lim) ans = mid, R = mid - 1;\n \n         else L = mid + 1;\n \n     }\n \n     printf(\"%d\\n\", ans);\n \n     return 0;\n \n }\n"}