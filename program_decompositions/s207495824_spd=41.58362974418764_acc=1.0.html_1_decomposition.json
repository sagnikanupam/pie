{"optimized_code": "#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <iostream>\n#define ri register int \n#define ll long long \nusing std::min;\nusing std::max;\nconst int maxn=200005;\nconst int inf=0x7fffffff;\nint n,nn,a[maxn],b[maxn],c[maxn],mx=-inf,mi=inf;\nll sum[maxn<<2];\ninline void update(int x,int d){for(;x<=nn;x+=x&(-x))sum[x]+=d;}\ninline ll query(int x){ll ans=0;for(;x;x-=x&(-x))ans+=sum[x];return ans;}\ninline ll chk(int k){ll ans=0;b[0]=0;for(ri i=1;i<=n;i++){b[i]=b[i-1]+((a[i]<=k)?1:-1);c[i]=b[i];ans+=(b[i]>0);}std::sort(c+1,c+1+n);nn=std::unique(c+1,c+1+n)-(c+1);memset(sum,0,sizeof(sum));for(ri i=1;i<=n;i++){b[i]=std::lower_bound(c+1,c+1+nn,b[i])-c;ans+=query(b[i]-1);update(b[i],1);}return ans;}\nint main(){\n    std::cin >> n;\n    for(ri i=1;i<=n;i++){\n        std::cin >> a[i];\n        mi=min(mi,a[i]),mx=max(mx,a[i]);\n    }\n    int L=mi,R=mx,mid,ans;\n    ll lim=1ll*n*(n+1)/4+1;\n    while(L<=R){\n        mid=(L+R)>>1;\n        if(chk(mid)>=lim)ans=mid,R=mid-1;\n        else L=mid+1;\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}"}