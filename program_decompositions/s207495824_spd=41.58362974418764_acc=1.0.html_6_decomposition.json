{"optimized_code": "#include <iostream>\n#include <algorithm>\n#define ri register int \n#define ll long long \nusing std::min;\nusing std::max;\nconst int maxn=200005;\nconst ll inf=0x7fffffff;\nint n,a[maxn];\nll sum[maxn];\n\ninline void update(int x,int d) {\n    for(; x <= n; x += x & (-x))\n        sum[x] += d;\n}\n\ninline ll query(int x) {\n    ll ans = 0;\n    for(; x; x -= x & (-x))\n        ans += sum[x];\n    return ans;\n}\n\ninline ll chk(int k) {\n    ll ans = 0;\n    int count = 0, b[maxn] = {0};\n    for(ri i = 1; i <= n; i++) {\n        b[i] = b[i - 1] + ((a[i] <= k) ? 1 : -1);\n        count += (b[i] > 0);\n    }\n    std::fill_n(sum, n + 1, 0);\n    for(ri i = 1; i <= n; i++) {\n        ans += query(b[i] - 1);\n        update(b[i], 1);\n    }\n    return ans;\n}\n\ninline void read_input() {\n    std::cin >> n;\n    for(ri i = 1; i <= n; i++) {\n        std::cin >> a[i];\n    }\n}\n\nint main() {\n    read_input();\n    int mx = a[1], mi = a[1];\n    for(ri i = 2; i <= n; i++) {\n        mi = min(mi, a[i]);\n        mx = max(mx, a[i]);\n    }\n    int L = mi, R = mx, mid, ans;\n    ll lim = static_cast<ll>(n) * (n + 1) >> 2 | 1;\n    while(L <= R) {\n        mid = (L + R) >> 1;\n        if(chk(mid) >= lim) {\n            ans = mid;\n            R = mid - 1;\n        } else {\n            L = mid + 1;\n        }\n    }\n    printf(\"%d\\n\", ans);\n    return 0;\n}"}